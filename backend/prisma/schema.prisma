// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountStatus {
  PENDING_VERIFICATION
  ACTIVE
  SUSPENDED
}

model MinecraftAccount {
  accountId             String        @id @default(uuid())
  keycloakUserId        String
  loginEmail            String        @unique
  ingameName            String?
  status                AccountStatus @default(PENDING_VERIFICATION)
  authenticationCache   Json?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt

  session BotSession?

  @@index([keycloakUserId])
}

model BotSession {
  sessionId              String   @id @default(uuid())
  lastKnownServerAddress String?
  lastKnownServerPort    Int?
  lastKnownVersion       String?
  isActive               Boolean  @default(false)
  status                 String   @default("offline")
  lastKickReason         String?
  lastSeenAt             DateTime @default(now())

  account   MinecraftAccount @relation(fields: [accountId], references: [accountId], onDelete: Cascade)
  accountId String           @unique
}