<div class="management-container">
  <h1>Account Management</h1>

  <!-- Formular zum HinzufÃ¼gen neuer Accounts -->
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>Add New Minecraft Account</mat-card-title>
      <mat-card-subtitle>
        Add your Microsoft account email. You will be prompted to log in via a secure link when you start the bot for the first time.
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="addAccountForm" (ngSubmit)="onAddAccountSubmit()" class="add-form">

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Microsoft Account Email</mat-label>
          <input matInput formControlName="loginEmail" type="email" placeholder="user@example.com" required>
          <mat-icon matSuffix>email</mat-icon>
          @if (loginEmail?.invalid && (loginEmail?.dirty || loginEmail?.touched)) {
            <mat-error>
              @if (loginEmail?.errors?.['required']) { Email is required. }
              @if (loginEmail?.errors?.['email']) { Please enter a valid email address. }
            </mat-error>
          }
        </mat-form-field>

        <button mat-flat-button color="primary" type="submit" [disabled]="addAccountForm.invalid || isLoading">
          <mat-icon>add</mat-icon>
          @if(isLoading) { Adding... } @else { Add Account }
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Liste der bestehenden Accounts -->
  <div class="account-list-header">
    <h2>Your Linked Accounts</h2>
    <mat-progress-bar mode="indeterminate" *ngIf="isListLoading"></mat-progress-bar>
  </div>

  <mat-list role="list" class="account-list">
    @for(account of accounts; track account.accountId) {
      <mat-list-item role="listitem">
        <mat-icon matListItemIcon class="account-icon">person_outline</mat-icon>
        <div matListItemTitle class="account-name">{{ account.ingameName || 'Name will appear after first login' }}</div>
        <div matListItemLine class="account-email">{{ account.loginEmail }}</div>
        <div matListItemMeta class="actions">
          <button mat-icon-button color="warn"
                  (click)="deleteAccount(account.accountId, account.ingameName || account.loginEmail)"
                  matTooltip="Delete this account">
            <mat-icon>delete_forever</mat-icon>
          </button>
        </div>
      </mat-list-item>
    } @empty {
      @if(!isListLoading) {
        <p class="empty-list-message">No accounts found. Add one using the form above.</p>
      }
    }
  </mat-list>
</div>
